name: Optimized Qt6 Build

on: [push]

jobs:
  build:
    runs-on: ubuntu-22.04
    timeout-minutes: 15

    steps:
    - name: Install Qt via aqt
      run: |
        sudo apt-get update
        sudo apt-get install -y python3-pip
        pip install aqtinstall
        aqt install-qt linux desktop 6.6.3 --outputdir ~/Qt
        echo "QT_PATH=~/Qt/6.6.3/gcc_64" >> $GITHUB_ENV

    - name: Build Fcitx5
      run: |
        git clone --depth 1 https://code.qt.io/fcitx5/fcitx5.git
        cd fcitx5/plugins/platforminputcontext
        mkdir build && cd build
        cmake .. -DCMAKE_PREFIX_PATH="$QT_PATH" -DCMAKE_BUILD_TYPE=Release
        cmake --build . --target fcitx5platforminputcontextplugin

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: fcitx5-plugin
        path: fcitx5/plugins/platforminputcontext/build/*.so
